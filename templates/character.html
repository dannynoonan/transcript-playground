{% extends "base.html" %}

{% block title %} 
	<title>{{ tdata['show_key'] }}: {{ tdata['speaker'] }}</title>
{% endblock %} 

{% block content %} 
	<div class="margin">
        <h3><strong>{{ tdata['speaker'] }}</strong> character page</h3>
        <h5>{{ tdata['episode_count'] }} episodes, {{ tdata['scene_count'] }} scenes, {{ tdata['scene_event_count'] }} lines, XX words</h5>
		<p>&nbsp;</p>

        <div class="row">
            <div class="col-5">
                <h3>{{ tdata['episode_count'] }} episodes with {{ tdata['speaker'] }}</h3></h3>
                <div class="overflow-scroll" style="max-height: 1000px;">
					<table class="table table-hover table-striped table-fit">
						<thead>
							<tr class="table-success">
								<th scope="col">Title</th>
								<th scope="col">Season</th>
								<th scope="col">Episode</th>
								<th scope="col">Air date</th>
								<th scope="col">Score</th>
							</tr>
						</thead>
						<tbody>
							{% for episode in tdata['episodes'] %}
							<tr class="table-light">
								<th scope="row"><a href="/web/episode/{{ episode['show_key'] }}/{{ episode['episode_key'] }}">{{ episode['title'] }}</a></th>
								<td>{{ episode['season'] }}</td>
								<td>{{ episode['sequence_in_season'] }}</td>
								<td>{{ episode['air_date'] }}</td>
								<td>{{ '%0.2f'|format(episode['agg_score']|float) }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
            </div>
			<div class="col-3">
                <h3>Where is {{ tdata['speaker'] }}?</h3>
                <div class="overflow-scroll" style="max-height: 1000px;">
                    <table class="table table-hover table-striped table-fit">
                        <thead>
                            <tr class="table-primary">
                                <th scope="col">Location</th>
                                <th scope="col">Scenes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for location, count in tdata['location_counts'].items() %}
                            <tr class="table-secondary">
                                <th scope="row">{{ location }}</th>
                                <td><a href="
                                    {% if location == 'TOTAL' %}
                                        /web/episode_search/{{ tdata['show_key'] }}?speaker={{ tdata['speaker'] }}&search_type=advanced
                                    {% else %}
                                        /web/episode_search/{{ tdata['show_key'] }}?speaker={{ tdata['speaker'] }}&location={{ location }}&search_type=advanced
                                    {% endif %}
                                        " class="alert-link" >{{ count }}</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-3">
                <h3>Who is {{ tdata['speaker'] }} with?</h3>
                <div class="overflow-scroll" style="max-height: 1000px;">
                    <table class="table table-hover table-striped table-fit">
                        <thead>
                            <tr class="table-success">
                                <th scope="col">Character</th>
                                <th scope="col">Episodes</th>
                                <th scope="col">Scenes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for other_speaker_aggs in tdata['other_speaker_agg_composite'] %}
                            <tr class="table-secondary">
                                <th scope="row"><a class="alert-link" href="/web/character/{{ tdata['show_key'] }}/{{ other_speaker_aggs['other_speaker'] }}">{{ other_speaker_aggs['other_speaker'] }}</a></th>
                                <td><a href="/web/episode_search/{{ tdata['show_key'] }}?speakers={{ tdata['speaker'] }},{{ other_speaker_aggs['other_speaker'] }}&search_type=advanced_multi_speaker" 
                                        class="alert-link" >{{ other_speaker_aggs['episode_count'] }}</a></td>
                                <td>{{ other_speaker_aggs['scene_count'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
		
    </div>
{% endblock %} 